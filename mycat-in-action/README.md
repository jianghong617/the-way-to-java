# `Mycat`

> **原理**
>
> `Mycat` 的原理中最重要的一个动词是"拦截",它拦截了用户发送过来的`SQL` 语句,首先对`SQL `语句做了一些特定的分析:如分片分析、路由分析、读写分离分析、缓存分析等,然后将此`SQL` 发往后端的真实数据库,并将返回的结果做适当的处理,最终再返回给用户.

## 1.概念

### 1.1.逻辑库(`Schema`)

> 通常对实际应用来说,并不需要知道中间件的存在,业务开发人员只需要知道数据库的概念,所以数据库中间件可以被看做是一个或多个数据库集群构成的逻辑库.

### 1.2.逻辑表(`Table`)

> 既然有逻辑库,那么就会有逻辑表,分布式数据库中,对应用来说,读写数据的表就是逻辑表.逻辑表,可以是数据切分后,分布在一个或多个分片库中,也可以不做数据切分,不分片,只有一个表构成.

#### 1.2.1.分片表

> 分片表,是指那些原有的很大数据的表,需要切分到多个数据库的表,这样,每个分片都有一部分数据,所有分片构成了完整的数据.

#### 1.2.2.非分片表

> 一个数据库中并不是所有的表都很大,某些表是可以不用进行切分的,非分片是相对分片表来说的,就是那些不需要进行数据切分的表.

#### 1.2.3.`ER`表

> 关系型数据库是基于实体关系模型( `Entity-Relationship Model`)之上,通过其描述了真实世界中事物与关系,`Mycat`中的ER 表即是来源于此.根据这一思路,提出了基于`E-R` 关系的数据分片策略,子表的记录与所关联的父表记录存放在同一个数据分片上,即子表依赖于父表,通过表分组(`Table Group`)保证数据`Join` 不会跨库操作.表分组(`Table Group`)是解决跨分片数据`Join` 的一种很好的思路,也是数据切分规划的重要一条规则.
>

#### 1.2.4.全局表

> 一个真实的业务系统中,往往存在大量的类似字典表的表,这些表基本上很少变动,字典表具有以下几个特性:
>
> - 变动不频繁;  
>
> - 数据量总体变化不大;  
>
> - 数据规模不大,很少有超过数十万条记录.  
>
> 对于这类的表,在分片的情况下,当业务表因为规模而进行分片以后,业务表与这些附属的字典表之间的关联,就成了比较棘手的问题,所以 `Mycat`中通过数据冗余来解决这类表的 `Join`,即所有的分片都有一份数据的拷贝,所有将字典表或者符合字典表特性的一些表定义为全局表.
>
> 数据冗余是解决跨分片数据 `Join `的一种很好的思路,也是数据切分规划的另外一条重要规则.

### 1.3.分片节点(`DataNode`)

> 数据切分后,一个大表被分到不同的分片数据库上面,每个表分片所在的数据库就是分片节点(`DataNode`)

### 1.4.节点主机(`DataHost`)

> 数据切分后,每个分片节点(`DataNode`)不一定都会独占一台机器,同一机器上面可以有多个分片数据库,这样一个或多个分片节点(`DataNode`)所在的机器就是节点主机(`DataHost`),为了规避单节点主机并发数限制,尽量将读写压力高的分片节点(`DataNode`)均衡的放在不同的节点主机(`DataHost`).

### 1.5.分片规则(`Rule`)

> 前面讲了数据切分,一个大表被分成若干个分片表,就需要一定的规则,这样按照某种业务规则把数据分到某个分片的规则就是分片规则,数据切分选择合适的分片规则非常重要,将极大的避免后续数据处理的难度.

### 1.6.全局序列号(`Sequence`)

> 数据切分后,原有的关系数据库中的主键约束在分布式条件下将无法使用,因此需要引入外部机制保证数据唯一性标识,这种保证全局性的数据唯一标识的机制就是全局序列号(`sequence`)